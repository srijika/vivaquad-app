{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = getSaga;\n\nvar _getIterator2 = _interopRequireDefault(require(\"@babel/runtime/core-js/get-iterator\"));\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _invariant = _interopRequireDefault(require(\"invariant\"));\n\nvar sagaEffects = _interopRequireWildcard(require(\"redux-saga/lib/effects\"));\n\nvar _warning = _interopRequireDefault(require(\"warning\"));\n\nvar _sagaHelpers = require(\"redux-saga/lib/internal/sagaHelpers\");\n\nvar _constants = require(\"./constants\");\n\nvar _prefixType = _interopRequireDefault(require(\"./prefixType\"));\n\nfunction getSaga(effects, model, onError, onEffect) {\n  return /*#__PURE__*/_regenerator.default.mark(function _callee3() {\n    var key;\n    return _regenerator.default.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.t0 = _regenerator.default.keys(effects);\n\n          case 1:\n            if ((_context3.t1 = _context3.t0()).done) {\n              _context3.next = 7;\n              break;\n            }\n\n            key = _context3.t1.value;\n\n            if (!Object.prototype.hasOwnProperty.call(effects, key)) {\n              _context3.next = 5;\n              break;\n            }\n\n            return _context3.delegateYield( /*#__PURE__*/_regenerator.default.mark(function _callee2() {\n              var watcher, task;\n              return _regenerator.default.wrap(function _callee2$(_context2) {\n                while (1) {\n                  switch (_context2.prev = _context2.next) {\n                    case 0:\n                      watcher = getWatcher(key, effects[key], model, onError, onEffect);\n                      _context2.next = 3;\n                      return sagaEffects.fork(watcher);\n\n                    case 3:\n                      task = _context2.sent;\n                      _context2.next = 6;\n                      return sagaEffects.fork( /*#__PURE__*/_regenerator.default.mark(function _callee() {\n                        return _regenerator.default.wrap(function _callee$(_context) {\n                          while (1) {\n                            switch (_context.prev = _context.next) {\n                              case 0:\n                                _context.next = 2;\n                                return sagaEffects.take(\"\".concat(model.namespace, \"/@@CANCEL_EFFECTS\"));\n\n                              case 2:\n                                _context.next = 4;\n                                return sagaEffects.cancel(task);\n\n                              case 4:\n                              case \"end\":\n                                return _context.stop();\n                            }\n                          }\n                        }, _callee, this);\n                      }));\n\n                    case 6:\n                    case \"end\":\n                      return _context2.stop();\n                  }\n                }\n              }, _callee2, this);\n            })(), \"t2\", 5);\n\n          case 5:\n            _context3.next = 1;\n            break;\n\n          case 7:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, this);\n  });\n}\n\nfunction getWatcher(key, _effect, model, onError, onEffect) {\n  var _marked = /*#__PURE__*/_regenerator.default.mark(sagaWithCatch);\n\n  var effect = _effect;\n  var type = 'takeEvery';\n  var ms;\n\n  if (Array.isArray(_effect)) {\n    effect = _effect[0];\n    var opts = _effect[1];\n\n    if (opts && opts.type) {\n      type = opts.type;\n\n      if (type === 'throttle') {\n        (0, _invariant.default)(opts.ms, 'app.start: opts.ms should be defined if type is throttle');\n        ms = opts.ms;\n      }\n    }\n\n    (0, _invariant.default)(['watcher', 'takeEvery', 'takeLatest', 'throttle'].indexOf(type) > -1, 'app.start: effect type should be takeEvery, takeLatest, throttle or watcher');\n  }\n\n  function noop() {}\n\n  function sagaWithCatch() {\n    var _len,\n        args,\n        _key,\n        _ref,\n        _ref$__dva_resolve,\n        resolve,\n        _ref$__dva_reject,\n        reject,\n        ret,\n        _args4 = arguments;\n\n    return _regenerator.default.wrap(function sagaWithCatch$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            for (_len = _args4.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n              args[_key] = _args4[_key];\n            }\n\n            _ref = args.length > 0 ? args[0] : {}, _ref$__dva_resolve = _ref.__dva_resolve, resolve = _ref$__dva_resolve === void 0 ? noop : _ref$__dva_resolve, _ref$__dva_reject = _ref.__dva_reject, reject = _ref$__dva_reject === void 0 ? noop : _ref$__dva_reject;\n            _context4.prev = 2;\n            _context4.next = 5;\n            return sagaEffects.put({\n              type: \"\".concat(key).concat(_constants.NAMESPACE_SEP, \"@@start\")\n            });\n\n          case 5:\n            _context4.next = 7;\n            return effect.apply(void 0, (0, _toConsumableArray2.default)(args.concat(createEffects(model))));\n\n          case 7:\n            ret = _context4.sent;\n            _context4.next = 10;\n            return sagaEffects.put({\n              type: \"\".concat(key).concat(_constants.NAMESPACE_SEP, \"@@end\")\n            });\n\n          case 10:\n            resolve(ret);\n            _context4.next = 17;\n            break;\n\n          case 13:\n            _context4.prev = 13;\n            _context4.t0 = _context4[\"catch\"](2);\n            onError(_context4.t0, {\n              key: key,\n              effectArgs: args\n            });\n\n            if (!_context4.t0._dontReject) {\n              reject(_context4.t0);\n            }\n\n          case 17:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _marked, this, [[2, 13]]);\n  }\n\n  var sagaWithOnEffect = applyOnEffect(onEffect, sagaWithCatch, model, key);\n\n  switch (type) {\n    case 'watcher':\n      return sagaWithCatch;\n\n    case 'takeLatest':\n      return /*#__PURE__*/_regenerator.default.mark(function _callee4() {\n        return _regenerator.default.wrap(function _callee4$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return (0, _sagaHelpers.takeLatestHelper)(key, sagaWithOnEffect);\n\n              case 2:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee4, this);\n      });\n\n    case 'throttle':\n      return /*#__PURE__*/_regenerator.default.mark(function _callee5() {\n        return _regenerator.default.wrap(function _callee5$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return (0, _sagaHelpers.throttleHelper)(ms, key, sagaWithOnEffect);\n\n              case 2:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee5, this);\n      });\n\n    default:\n      return /*#__PURE__*/_regenerator.default.mark(function _callee6() {\n        return _regenerator.default.wrap(function _callee6$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return (0, _sagaHelpers.takeEveryHelper)(key, sagaWithOnEffect);\n\n              case 2:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee6, this);\n      });\n  }\n}\n\nfunction createEffects(model) {\n  function assertAction(type, name) {\n    (0, _invariant.default)(type, 'dispatch: action should be a plain Object with type');\n    (0, _warning.default)(type.indexOf(\"\".concat(model.namespace).concat(_constants.NAMESPACE_SEP)) !== 0, \"[\".concat(name, \"] \").concat(type, \" should not be prefixed with namespace \").concat(model.namespace));\n  }\n\n  function put(action) {\n    var type = action.type;\n    assertAction(type, 'sagaEffects.put');\n    return sagaEffects.put((0, _objectSpread2.default)({}, action, {\n      type: (0, _prefixType.default)(type, model)\n    }));\n  } // The operator `put` doesn't block waiting the returned promise to resolve.\n  // Using `put.resolve` will wait until the promsie resolve/reject before resuming.\n  // It will be helpful to organize multi-effects in order,\n  // and increase the reusability by seperate the effect in stand-alone pieces.\n  // https://github.com/redux-saga/redux-saga/issues/336\n\n\n  function putResolve(action) {\n    var type = action.type;\n    assertAction(type, 'sagaEffects.put.resolve');\n    return sagaEffects.put.resolve((0, _objectSpread2.default)({}, action, {\n      type: (0, _prefixType.default)(type, model)\n    }));\n  }\n\n  put.resolve = putResolve;\n\n  function take(type) {\n    if (typeof type === 'string') {\n      assertAction(type, 'sagaEffects.take');\n      return sagaEffects.take((0, _prefixType.default)(type, model));\n    } else if (Array.isArray(type)) {\n      return sagaEffects.take(type.map(function (t) {\n        if (typeof t === 'string') {\n          assertAction(t, 'sagaEffects.take');\n          return (0, _prefixType.default)(t, model);\n        }\n\n        return t;\n      }));\n    } else {\n      return sagaEffects.take(type);\n    }\n  }\n\n  return (0, _objectSpread2.default)({}, sagaEffects, {\n    put: put,\n    take: take\n  });\n}\n\nfunction applyOnEffect(fns, effect, model, key) {\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = (0, _getIterator2.default)(fns), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var fn = _step.value;\n      effect = fn(effect, sagaEffects, model, key);\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  return effect;\n}","map":{"version":3,"sources":["/var/www/html/project/vivaquad/admin-vivaquad/node_modules/dva-core/lib/getSaga.js"],"names":["_interopRequireWildcard","require","_interopRequireDefault","Object","defineProperty","exports","value","default","getSaga","_getIterator2","_objectSpread2","_toConsumableArray2","_regenerator","_invariant","sagaEffects","_warning","_sagaHelpers","_constants","_prefixType","effects","model","onError","onEffect","mark","_callee3","key","wrap","_callee3$","_context3","prev","next","t0","keys","t1","done","prototype","hasOwnProperty","call","delegateYield","_callee2","watcher","task","_callee2$","_context2","getWatcher","fork","sent","_callee","_callee$","_context","take","concat","namespace","cancel","stop","_effect","_marked","sagaWithCatch","effect","type","ms","Array","isArray","opts","indexOf","noop","_len","args","_key","_ref","_ref$__dva_resolve","resolve","_ref$__dva_reject","reject","ret","_args4","arguments","sagaWithCatch$","_context4","length","__dva_resolve","__dva_reject","put","NAMESPACE_SEP","apply","createEffects","effectArgs","_dontReject","sagaWithOnEffect","applyOnEffect","_callee4","_callee4$","_context5","takeLatestHelper","_callee5","_callee5$","_context6","throttleHelper","_callee6","_callee6$","_context7","takeEveryHelper","assertAction","name","action","putResolve","map","t","fns","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","_step","fn","err","return"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = getSaga;\n\nvar _getIterator2 = _interopRequireDefault(require(\"@babel/runtime/core-js/get-iterator\"));\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _invariant = _interopRequireDefault(require(\"invariant\"));\n\nvar sagaEffects = _interopRequireWildcard(require(\"redux-saga/lib/effects\"));\n\nvar _warning = _interopRequireDefault(require(\"warning\"));\n\nvar _sagaHelpers = require(\"redux-saga/lib/internal/sagaHelpers\");\n\nvar _constants = require(\"./constants\");\n\nvar _prefixType = _interopRequireDefault(require(\"./prefixType\"));\n\nfunction getSaga(effects, model, onError, onEffect) {\n  return (\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee3() {\n      var key;\n      return _regenerator.default.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.t0 = _regenerator.default.keys(effects);\n\n            case 1:\n              if ((_context3.t1 = _context3.t0()).done) {\n                _context3.next = 7;\n                break;\n              }\n\n              key = _context3.t1.value;\n\n              if (!Object.prototype.hasOwnProperty.call(effects, key)) {\n                _context3.next = 5;\n                break;\n              }\n\n              return _context3.delegateYield(\n              /*#__PURE__*/\n              _regenerator.default.mark(function _callee2() {\n                var watcher, task;\n                return _regenerator.default.wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        watcher = getWatcher(key, effects[key], model, onError, onEffect);\n                        _context2.next = 3;\n                        return sagaEffects.fork(watcher);\n\n                      case 3:\n                        task = _context2.sent;\n                        _context2.next = 6;\n                        return sagaEffects.fork(\n                        /*#__PURE__*/\n                        _regenerator.default.mark(function _callee() {\n                          return _regenerator.default.wrap(function _callee$(_context) {\n                            while (1) {\n                              switch (_context.prev = _context.next) {\n                                case 0:\n                                  _context.next = 2;\n                                  return sagaEffects.take(\"\".concat(model.namespace, \"/@@CANCEL_EFFECTS\"));\n\n                                case 2:\n                                  _context.next = 4;\n                                  return sagaEffects.cancel(task);\n\n                                case 4:\n                                case \"end\":\n                                  return _context.stop();\n                              }\n                            }\n                          }, _callee, this);\n                        }));\n\n                      case 6:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2, this);\n              })(), \"t2\", 5);\n\n            case 5:\n              _context3.next = 1;\n              break;\n\n            case 7:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, this);\n    })\n  );\n}\n\nfunction getWatcher(key, _effect, model, onError, onEffect) {\n  var _marked =\n  /*#__PURE__*/\n  _regenerator.default.mark(sagaWithCatch);\n\n  var effect = _effect;\n  var type = 'takeEvery';\n  var ms;\n\n  if (Array.isArray(_effect)) {\n    effect = _effect[0];\n    var opts = _effect[1];\n\n    if (opts && opts.type) {\n      type = opts.type;\n\n      if (type === 'throttle') {\n        (0, _invariant.default)(opts.ms, 'app.start: opts.ms should be defined if type is throttle');\n        ms = opts.ms;\n      }\n    }\n\n    (0, _invariant.default)(['watcher', 'takeEvery', 'takeLatest', 'throttle'].indexOf(type) > -1, 'app.start: effect type should be takeEvery, takeLatest, throttle or watcher');\n  }\n\n  function noop() {}\n\n  function sagaWithCatch() {\n    var _len,\n        args,\n        _key,\n        _ref,\n        _ref$__dva_resolve,\n        resolve,\n        _ref$__dva_reject,\n        reject,\n        ret,\n        _args4 = arguments;\n\n    return _regenerator.default.wrap(function sagaWithCatch$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            for (_len = _args4.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n              args[_key] = _args4[_key];\n            }\n\n            _ref = args.length > 0 ? args[0] : {}, _ref$__dva_resolve = _ref.__dva_resolve, resolve = _ref$__dva_resolve === void 0 ? noop : _ref$__dva_resolve, _ref$__dva_reject = _ref.__dva_reject, reject = _ref$__dva_reject === void 0 ? noop : _ref$__dva_reject;\n            _context4.prev = 2;\n            _context4.next = 5;\n            return sagaEffects.put({\n              type: \"\".concat(key).concat(_constants.NAMESPACE_SEP, \"@@start\")\n            });\n\n          case 5:\n            _context4.next = 7;\n            return effect.apply(void 0, (0, _toConsumableArray2.default)(args.concat(createEffects(model))));\n\n          case 7:\n            ret = _context4.sent;\n            _context4.next = 10;\n            return sagaEffects.put({\n              type: \"\".concat(key).concat(_constants.NAMESPACE_SEP, \"@@end\")\n            });\n\n          case 10:\n            resolve(ret);\n            _context4.next = 17;\n            break;\n\n          case 13:\n            _context4.prev = 13;\n            _context4.t0 = _context4[\"catch\"](2);\n            onError(_context4.t0, {\n              key: key,\n              effectArgs: args\n            });\n\n            if (!_context4.t0._dontReject) {\n              reject(_context4.t0);\n            }\n\n          case 17:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _marked, this, [[2, 13]]);\n  }\n\n  var sagaWithOnEffect = applyOnEffect(onEffect, sagaWithCatch, model, key);\n\n  switch (type) {\n    case 'watcher':\n      return sagaWithCatch;\n\n    case 'takeLatest':\n      return (\n        /*#__PURE__*/\n        _regenerator.default.mark(function _callee4() {\n          return _regenerator.default.wrap(function _callee4$(_context5) {\n            while (1) {\n              switch (_context5.prev = _context5.next) {\n                case 0:\n                  _context5.next = 2;\n                  return (0, _sagaHelpers.takeLatestHelper)(key, sagaWithOnEffect);\n\n                case 2:\n                case \"end\":\n                  return _context5.stop();\n              }\n            }\n          }, _callee4, this);\n        })\n      );\n\n    case 'throttle':\n      return (\n        /*#__PURE__*/\n        _regenerator.default.mark(function _callee5() {\n          return _regenerator.default.wrap(function _callee5$(_context6) {\n            while (1) {\n              switch (_context6.prev = _context6.next) {\n                case 0:\n                  _context6.next = 2;\n                  return (0, _sagaHelpers.throttleHelper)(ms, key, sagaWithOnEffect);\n\n                case 2:\n                case \"end\":\n                  return _context6.stop();\n              }\n            }\n          }, _callee5, this);\n        })\n      );\n\n    default:\n      return (\n        /*#__PURE__*/\n        _regenerator.default.mark(function _callee6() {\n          return _regenerator.default.wrap(function _callee6$(_context7) {\n            while (1) {\n              switch (_context7.prev = _context7.next) {\n                case 0:\n                  _context7.next = 2;\n                  return (0, _sagaHelpers.takeEveryHelper)(key, sagaWithOnEffect);\n\n                case 2:\n                case \"end\":\n                  return _context7.stop();\n              }\n            }\n          }, _callee6, this);\n        })\n      );\n  }\n}\n\nfunction createEffects(model) {\n  function assertAction(type, name) {\n    (0, _invariant.default)(type, 'dispatch: action should be a plain Object with type');\n    (0, _warning.default)(type.indexOf(\"\".concat(model.namespace).concat(_constants.NAMESPACE_SEP)) !== 0, \"[\".concat(name, \"] \").concat(type, \" should not be prefixed with namespace \").concat(model.namespace));\n  }\n\n  function put(action) {\n    var type = action.type;\n    assertAction(type, 'sagaEffects.put');\n    return sagaEffects.put((0, _objectSpread2.default)({}, action, {\n      type: (0, _prefixType.default)(type, model)\n    }));\n  } // The operator `put` doesn't block waiting the returned promise to resolve.\n  // Using `put.resolve` will wait until the promsie resolve/reject before resuming.\n  // It will be helpful to organize multi-effects in order,\n  // and increase the reusability by seperate the effect in stand-alone pieces.\n  // https://github.com/redux-saga/redux-saga/issues/336\n\n\n  function putResolve(action) {\n    var type = action.type;\n    assertAction(type, 'sagaEffects.put.resolve');\n    return sagaEffects.put.resolve((0, _objectSpread2.default)({}, action, {\n      type: (0, _prefixType.default)(type, model)\n    }));\n  }\n\n  put.resolve = putResolve;\n\n  function take(type) {\n    if (typeof type === 'string') {\n      assertAction(type, 'sagaEffects.take');\n      return sagaEffects.take((0, _prefixType.default)(type, model));\n    } else if (Array.isArray(type)) {\n      return sagaEffects.take(type.map(function (t) {\n        if (typeof t === 'string') {\n          assertAction(t, 'sagaEffects.take');\n          return (0, _prefixType.default)(t, model);\n        }\n\n        return t;\n      }));\n    } else {\n      return sagaEffects.take(type);\n    }\n  }\n\n  return (0, _objectSpread2.default)({}, sagaEffects, {\n    put: put,\n    take: take\n  });\n}\n\nfunction applyOnEffect(fns, effect, model, key) {\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = (0, _getIterator2.default)(fns), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var fn = _step.value;\n      effect = fn(effect, sagaEffects, model, key);\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  return effect;\n}"]},"metadata":{},"sourceType":"script"}