{"ast":null,"code":"var _jsxFileName = \"/var/www/html/project/vivaquad/admin-vivaquad/src/components/sharing/upload-images/index.jsx\";\nimport React, { useState, useCallback, Fragment, useEffect, useRef } from 'react';\nimport { Button, Row, Col, Upload, Modal } from 'antd';\nimport ImgCrop from 'antd-img-crop';\nimport { connect } from 'dva';\nimport styles from './index.less';\n\nconst UploadImages = props => {\n  const [disableBtn, setDisableBtn] = useState(false);\n  const [count, setCount] = useState(0);\n  const [fileList, setFileList] = useState([]);\n  const inputRef = useRef();\n  const {\n    dispatch\n  } = props;\n  useEffect(() => {\n    let unmounted = false;\n    return () => {\n      unmounted = true;\n    };\n  }, [props]);\n\n  const onChange = _ref => {\n    let {\n      fileList: newFileList\n    } = _ref;\n    setFileList(newFileList);\n  };\n\n  const onPreview = async file => {\n    let src = file.url;\n\n    if (!src) {\n      src = await new Promise(resolve => {\n        const reader = new FileReader();\n        reader.readAsDataURL(file.originFileObj);\n\n        reader.onload = () => resolve(reader.result);\n      });\n    }\n\n    const image = new Image();\n    image.src = src;\n    const imgWindow = window.open(src);\n    imgWindow.document.write(image.outerHTML);\n  };\n\n  const onFinish = () => {\n    let rData = [];\n    fileList.map(item => rData.push({\n      file: item.originFileObj,\n      urls: item.thumbUrl\n    }));\n    setDisableBtn(true);\n    setCount(rData.count);\n\n    if (props.Extra) {\n      rData['Extra'] = props.Extra;\n    }\n\n    ;\n    props.returnImg(rData);\n    props.closeFun();\n    setFileList([]);\n    setCount(0);\n    setDisableBtn(false);\n  };\n\n  const cancelFun = () => {\n    setDisableBtn(false);\n    props.closeFun();\n  };\n\n  const dummyUploadRequest = _ref2 => {\n    let {\n      file,\n      onSuccess\n    } = _ref2;\n    setTimeout(() => {\n      onSuccess(\"ok\");\n    }, 0);\n  };\n\n  useEffect(() => {\n    let unmounted = false;\n\n    if (props.resetVal.length === 0) {\n      setFileList([]);\n    }\n\n    return () => {\n      unmounted = true;\n    };\n  }, [props.resetVal]);\n  return /*#__PURE__*/React.createElement(Modal, {\n    key: 1111,\n    visible: props.visible,\n    title: \"Upload Image's\",\n    okText: \"Upload\",\n    onCancel: cancelFun,\n    onOk: onFinish,\n    okButtonProps: {\n      disabled: disableBtn\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Upload, {\n    customRequest: dummyUploadRequest,\n    listType: \"picture-card\",\n    fileList: fileList,\n    showUploadList: {\n      showPreviewIcon: false\n    },\n    onChange: onChange,\n    onPreview: onPreview,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 4\n    }\n  }, fileList.length < (props.limit || 5) && '+ Upload'));\n}; //export default CropImage;\n\n\nexport default connect(_ref3 => {\n  let {\n    global\n  } = _ref3;\n  return {\n    global: global\n  };\n})(UploadImages);","map":{"version":3,"sources":["/var/www/html/project/vivaquad/admin-vivaquad/src/components/sharing/upload-images/index.jsx"],"names":["React","useState","useCallback","Fragment","useEffect","useRef","Button","Row","Col","Upload","Modal","ImgCrop","connect","styles","UploadImages","props","disableBtn","setDisableBtn","count","setCount","fileList","setFileList","inputRef","dispatch","unmounted","onChange","newFileList","onPreview","file","src","url","Promise","resolve","reader","FileReader","readAsDataURL","originFileObj","onload","result","image","Image","imgWindow","window","open","document","write","outerHTML","onFinish","rData","map","item","push","urls","thumbUrl","Extra","returnImg","closeFun","cancelFun","dummyUploadRequest","onSuccess","setTimeout","resetVal","length","visible","disabled","showPreviewIcon","limit","global"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, Fragment, useEffect, useRef } from 'react';\r\nimport { Button, Row, Col, Upload, Modal } from 'antd';\r\nimport ImgCrop from 'antd-img-crop';\r\nimport { connect } from 'dva';\r\n\r\nimport styles from './index.less';\r\n\r\nconst UploadImages = props =>{\r\n\tconst [disableBtn, setDisableBtn] = useState(false);\r\n\tconst [count, setCount] = useState(0)\r\n\tconst [fileList, setFileList] = useState([])\r\n\tconst inputRef = useRef();\r\n\tconst {dispatch} = props;\r\n\t\r\n\tuseEffect(() => {\r\n\t\tlet unmounted = false;\r\n\t\treturn () => {unmounted = true; }\r\n    },[props])\r\n\t\r\n\tconst onChange = ({ fileList: newFileList }) => {\r\n\t\tsetFileList(newFileList);\r\n\t  };\r\n\r\n\tconst onPreview = async file => {\r\n\t\tlet src = file.url;\r\n\t\tif (!src) {\r\n\t\t  src = await new Promise(resolve => {\r\n\t\t\tconst reader = new FileReader();\r\n\t\t\treader.readAsDataURL(file.originFileObj);\r\n\t\t\treader.onload = () => resolve(reader.result);\r\n\t\t  });\r\n\t\t}\r\n\t\tconst image = new Image();\r\n\t\timage.src = src;\r\n\t\tconst imgWindow = window.open(src);\r\n\t\timgWindow.document.write(image.outerHTML);\r\n\t};\r\n\t\r\n\tconst onFinish=()=>{\r\n\t\t\r\n\t\tlet rData = [];\r\n\t\tfileList.map(item=> rData.push({file : item.originFileObj, urls:item.thumbUrl}))\r\n\t\tsetDisableBtn(true)\r\n\t\tsetCount(rData.count);\r\n\r\n\t\tif(props.Extra){rData['Extra'] = props.Extra};\r\n\t\tprops.returnImg(rData)\r\n\t\tprops.closeFun();\r\n\t\tsetFileList([])\r\n\t\tsetCount(0);\r\n\t\tsetDisableBtn(false)\r\n\t\t\r\n\t}\r\n\t\r\n\tconst cancelFun=()=>{\r\n\t\tsetDisableBtn(false)\t\r\n\t\tprops.closeFun();\r\n\t}\r\n\t\r\n\tconst dummyUploadRequest = ({ file, onSuccess }) => {\r\n\t\tsetTimeout(() => {\r\n\t\t  onSuccess(\"ok\");\r\n\t\t}, 0);\r\n\t  };\r\n\r\n\tuseEffect(() => {\r\n\t\tlet unmounted = false;\r\n\t\tif(props.resetVal.length===0){\r\n\t\t\tsetFileList([])\r\n\t\t}\r\n\t\treturn () => {\r\n  \t  unmounted = true;\r\n      }\r\n\t}, [props.resetVal]); \r\n\t\r\n\treturn <Modal key={1111} visible={props.visible} title=\"Upload Image's\" okText=\"Upload\" onCancel={cancelFun} onOk={onFinish} okButtonProps={{ disabled: disableBtn }}>\r\n\t\t\t<Upload \r\n\t\t\t\tcustomRequest={dummyUploadRequest}\r\n\t\t\t\tlistType=\"picture-card\"\r\n\t\t\t\tfileList={fileList}\r\n\t\t\t\tshowUploadList={{showPreviewIcon:false}}\r\n\t\t\t\tonChange={onChange}\r\n\t\t\t\tonPreview={onPreview}\r\n\t\t\t>\r\n\t\t\t{fileList.length < (props.limit || 5) && '+ Upload'}\r\n\t\t  </Upload>\r\n        </Modal>\r\n\t\t\r\n}\r\n\r\n//export default CropImage;\r\nexport default connect(({global }) => ({\r\n  global: global,\r\n}))(UploadImages);"]},"metadata":{},"sourceType":"module"}