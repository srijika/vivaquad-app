{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.create = create;\n\nvar _getIterator2 = _interopRequireDefault(require(\"@babel/runtime/core-js/get-iterator\"));\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime/core-js/object/keys\"));\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nvar _redux = require(\"redux\");\n\nvar _middleware = _interopRequireDefault(require(\"redux-saga/lib/internal/middleware\"));\n\nvar _invariant = _interopRequireDefault(require(\"invariant\"));\n\nvar _checkModel = _interopRequireDefault(require(\"./checkModel\"));\n\nvar _prefixNamespace = _interopRequireDefault(require(\"./prefixNamespace\"));\n\nvar _Plugin = _interopRequireWildcard(require(\"./Plugin\"));\n\nvar _createStore = _interopRequireDefault(require(\"./createStore\"));\n\nvar _getSaga = _interopRequireDefault(require(\"./getSaga\"));\n\nvar _getReducer = _interopRequireDefault(require(\"./getReducer\"));\n\nvar _createPromiseMiddleware = _interopRequireDefault(require(\"./createPromiseMiddleware\"));\n\nvar _subscription = require(\"./subscription\");\n\nvar _utils = require(\"./utils\"); // Internal model to update global state when do unmodel\n\n\nvar dvaModel = {\n  namespace: '@@dva',\n  state: 0,\n  reducers: {\n    UPDATE: function UPDATE(state) {\n      return state + 1;\n    }\n  }\n};\n/**\n * Create dva-core instance.\n *\n * @param hooksAndOpts\n * @param createOpts\n */\n\nfunction create() {\n  var hooksAndOpts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var createOpts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var initialReducer = createOpts.initialReducer,\n      _createOpts$setupApp = createOpts.setupApp,\n      setupApp = _createOpts$setupApp === void 0 ? _utils.noop : _createOpts$setupApp;\n  var plugin = new _Plugin.default();\n  plugin.use((0, _Plugin.filterHooks)(hooksAndOpts));\n  var app = {\n    _models: [(0, _prefixNamespace.default)((0, _objectSpread2.default)({}, dvaModel))],\n    _store: null,\n    _plugin: plugin,\n    use: plugin.use.bind(plugin),\n    model: model,\n    start: start\n  };\n  return app;\n  /**\n   * Register model before app is started.\n   *\n   * @param m {Object} model to register\n   */\n\n  function model(m) {\n    if (process.env.NODE_ENV !== 'production') {\n      (0, _checkModel.default)(m, app._models);\n    }\n\n    var prefixedModel = (0, _prefixNamespace.default)((0, _objectSpread2.default)({}, m));\n\n    app._models.push(prefixedModel);\n\n    return prefixedModel;\n  }\n  /**\n   * Inject model after app is started.\n   *\n   * @param createReducer\n   * @param onError\n   * @param unlisteners\n   * @param m\n   */\n\n\n  function injectModel(createReducer, onError, unlisteners, m) {\n    m = model(m);\n    var store = app._store;\n    store.asyncReducers[m.namespace] = (0, _getReducer.default)(m.reducers, m.state, plugin._handleActions);\n    store.replaceReducer(createReducer());\n\n    if (m.effects) {\n      store.runSaga(app._getSaga(m.effects, m, onError, plugin.get('onEffect')));\n    }\n\n    if (m.subscriptions) {\n      unlisteners[m.namespace] = (0, _subscription.run)(m.subscriptions, m, app, onError);\n    }\n  }\n  /**\n   * Unregister model.\n   *\n   * @param createReducer\n   * @param reducers\n   * @param unlisteners\n   * @param namespace\n   *\n   * Unexpected key warn problem:\n   * https://github.com/reactjs/redux/issues/1636\n   */\n\n\n  function unmodel(createReducer, reducers, unlisteners, namespace) {\n    var store = app._store; // Delete reducers\n\n    delete store.asyncReducers[namespace];\n    delete reducers[namespace];\n    store.replaceReducer(createReducer());\n    store.dispatch({\n      type: '@@dva/UPDATE'\n    }); // Cancel effects\n\n    store.dispatch({\n      type: \"\".concat(namespace, \"/@@CANCEL_EFFECTS\")\n    }); // Unlisten subscrioptions\n\n    (0, _subscription.unlisten)(unlisteners, namespace); // Delete model from app._models\n\n    app._models = app._models.filter(function (model) {\n      return model.namespace !== namespace;\n    });\n  }\n  /**\n   * Replace a model if it exsits, if not, add it to app\n   * Attention:\n   * - Only available after dva.start gets called\n   * - Will not check origin m is strict equal to the new one\n   * Useful for HMR\n   * @param createReducer\n   * @param reducers\n   * @param unlisteners\n   * @param onError\n   * @param m\n   */\n\n\n  function replaceModel(createReducer, reducers, unlisteners, onError, m) {\n    var store = app._store;\n    var namespace = m.namespace;\n    var oldModelIdx = (0, _utils.findIndex)(app._models, function (model) {\n      return model.namespace === namespace;\n    });\n\n    if (~oldModelIdx) {\n      // Cancel effects\n      store.dispatch({\n        type: \"\".concat(namespace, \"/@@CANCEL_EFFECTS\")\n      }); // Delete reducers\n\n      delete store.asyncReducers[namespace];\n      delete reducers[namespace]; // Unlisten subscrioptions\n\n      (0, _subscription.unlisten)(unlisteners, namespace); // Delete model from app._models\n\n      app._models.splice(oldModelIdx, 1);\n    } // add new version model to store\n\n\n    app.model(m);\n    store.dispatch({\n      type: '@@dva/UPDATE'\n    });\n  }\n  /**\n   * Start the app.\n   *\n   * @returns void\n   */\n\n\n  function start() {\n    // Global error handler\n    var onError = function onError(err, extension) {\n      if (err) {\n        if (typeof err === 'string') err = new Error(err);\n\n        err.preventDefault = function () {\n          err._dontReject = true;\n        };\n\n        plugin.apply('onError', function (err) {\n          throw new Error(err.stack || err);\n        })(err, app._store.dispatch, extension);\n      }\n    };\n\n    var sagaMiddleware = (0, _middleware.default)();\n    var promiseMiddleware = (0, _createPromiseMiddleware.default)(app);\n    app._getSaga = _getSaga.default.bind(null);\n    var sagas = [];\n    var reducers = (0, _objectSpread2.default)({}, initialReducer);\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n      for (var _iterator = (0, _getIterator2.default)(app._models), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n        var m = _step.value;\n        reducers[m.namespace] = (0, _getReducer.default)(m.reducers, m.state, plugin._handleActions);\n        if (m.effects) sagas.push(app._getSaga(m.effects, m, onError, plugin.get('onEffect')));\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion && _iterator.return != null) {\n          _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n\n    var reducerEnhancer = plugin.get('onReducer');\n    var extraReducers = plugin.get('extraReducers');\n    (0, _invariant.default)((0, _keys.default)(extraReducers).every(function (key) {\n      return !(key in reducers);\n    }), \"[app.start] extraReducers is conflict with other reducers, reducers list: \".concat((0, _keys.default)(reducers).join(', '))); // Create store\n\n    var store = app._store = (0, _createStore.default)({\n      // eslint-disable-line\n      reducers: createReducer(),\n      initialState: hooksAndOpts.initialState || {},\n      plugin: plugin,\n      createOpts: createOpts,\n      sagaMiddleware: sagaMiddleware,\n      promiseMiddleware: promiseMiddleware\n    }); // Extend store\n\n    store.runSaga = sagaMiddleware.run;\n    store.asyncReducers = {}; // Execute listeners when state is changed\n\n    var listeners = plugin.get('onStateChange');\n    var _iteratorNormalCompletion2 = true;\n    var _didIteratorError2 = false;\n    var _iteratorError2 = undefined;\n\n    try {\n      var _loop = function _loop() {\n        var listener = _step2.value;\n        store.subscribe(function () {\n          listener(store.getState());\n        });\n      };\n\n      for (var _iterator2 = (0, _getIterator2.default)(listeners), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n        _loop();\n      } // Run sagas\n\n    } catch (err) {\n      _didIteratorError2 = true;\n      _iteratorError2 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n          _iterator2.return();\n        }\n      } finally {\n        if (_didIteratorError2) {\n          throw _iteratorError2;\n        }\n      }\n    }\n\n    sagas.forEach(sagaMiddleware.run); // Setup app\n\n    setupApp(app); // Run subscriptions\n\n    var unlisteners = {};\n    var _iteratorNormalCompletion3 = true;\n    var _didIteratorError3 = false;\n    var _iteratorError3 = undefined;\n\n    try {\n      for (var _iterator3 = (0, _getIterator2.default)(this._models), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n        var _model = _step3.value;\n\n        if (_model.subscriptions) {\n          unlisteners[_model.namespace] = (0, _subscription.run)(_model.subscriptions, _model, app, onError);\n        }\n      } // Setup app.model and app.unmodel\n\n    } catch (err) {\n      _didIteratorError3 = true;\n      _iteratorError3 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n          _iterator3.return();\n        }\n      } finally {\n        if (_didIteratorError3) {\n          throw _iteratorError3;\n        }\n      }\n    }\n\n    app.model = injectModel.bind(app, createReducer, onError, unlisteners);\n    app.unmodel = unmodel.bind(app, createReducer, reducers, unlisteners);\n    app.replaceModel = replaceModel.bind(app, createReducer, reducers, unlisteners, onError);\n    /**\n     * Create global reducer for redux.\n     *\n     * @returns {Object}\n     */\n\n    function createReducer() {\n      return reducerEnhancer((0, _redux.combineReducers)((0, _objectSpread2.default)({}, reducers, extraReducers, app._store ? app._store.asyncReducers : {})));\n    }\n  }\n}","map":{"version":3,"sources":["/var/www/html/project/vivaquad/admin-vivaquad/node_modules/dva-core/lib/index.js"],"names":["_interopRequireWildcard","require","_interopRequireDefault","Object","defineProperty","exports","value","create","_getIterator2","_keys","_objectSpread2","_redux","_middleware","_invariant","_checkModel","_prefixNamespace","_Plugin","_createStore","_getSaga","_getReducer","_createPromiseMiddleware","_subscription","_utils","dvaModel","namespace","state","reducers","UPDATE","hooksAndOpts","arguments","length","undefined","createOpts","initialReducer","_createOpts$setupApp","setupApp","noop","plugin","default","use","filterHooks","app","_models","_store","_plugin","bind","model","start","m","process","env","NODE_ENV","prefixedModel","push","injectModel","createReducer","onError","unlisteners","store","asyncReducers","_handleActions","replaceReducer","effects","runSaga","get","subscriptions","run","unmodel","dispatch","type","concat","unlisten","filter","replaceModel","oldModelIdx","findIndex","splice","err","extension","Error","preventDefault","_dontReject","apply","stack","sagaMiddleware","promiseMiddleware","sagas","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","next","done","return","reducerEnhancer","extraReducers","every","key","join","initialState","listeners","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_loop","listener","_step2","subscribe","getState","_iterator2","forEach","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","_model","combineReducers"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.create = create;\n\nvar _getIterator2 = _interopRequireDefault(require(\"@babel/runtime/core-js/get-iterator\"));\n\nvar _keys = _interopRequireDefault(require(\"@babel/runtime/core-js/object/keys\"));\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nvar _redux = require(\"redux\");\n\nvar _middleware = _interopRequireDefault(require(\"redux-saga/lib/internal/middleware\"));\n\nvar _invariant = _interopRequireDefault(require(\"invariant\"));\n\nvar _checkModel = _interopRequireDefault(require(\"./checkModel\"));\n\nvar _prefixNamespace = _interopRequireDefault(require(\"./prefixNamespace\"));\n\nvar _Plugin = _interopRequireWildcard(require(\"./Plugin\"));\n\nvar _createStore = _interopRequireDefault(require(\"./createStore\"));\n\nvar _getSaga = _interopRequireDefault(require(\"./getSaga\"));\n\nvar _getReducer = _interopRequireDefault(require(\"./getReducer\"));\n\nvar _createPromiseMiddleware = _interopRequireDefault(require(\"./createPromiseMiddleware\"));\n\nvar _subscription = require(\"./subscription\");\n\nvar _utils = require(\"./utils\");\n\n// Internal model to update global state when do unmodel\nvar dvaModel = {\n  namespace: '@@dva',\n  state: 0,\n  reducers: {\n    UPDATE: function UPDATE(state) {\n      return state + 1;\n    }\n  }\n};\n/**\n * Create dva-core instance.\n *\n * @param hooksAndOpts\n * @param createOpts\n */\n\nfunction create() {\n  var hooksAndOpts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var createOpts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var initialReducer = createOpts.initialReducer,\n      _createOpts$setupApp = createOpts.setupApp,\n      setupApp = _createOpts$setupApp === void 0 ? _utils.noop : _createOpts$setupApp;\n  var plugin = new _Plugin.default();\n  plugin.use((0, _Plugin.filterHooks)(hooksAndOpts));\n  var app = {\n    _models: [(0, _prefixNamespace.default)((0, _objectSpread2.default)({}, dvaModel))],\n    _store: null,\n    _plugin: plugin,\n    use: plugin.use.bind(plugin),\n    model: model,\n    start: start\n  };\n  return app;\n  /**\n   * Register model before app is started.\n   *\n   * @param m {Object} model to register\n   */\n\n  function model(m) {\n    if (process.env.NODE_ENV !== 'production') {\n      (0, _checkModel.default)(m, app._models);\n    }\n\n    var prefixedModel = (0, _prefixNamespace.default)((0, _objectSpread2.default)({}, m));\n\n    app._models.push(prefixedModel);\n\n    return prefixedModel;\n  }\n  /**\n   * Inject model after app is started.\n   *\n   * @param createReducer\n   * @param onError\n   * @param unlisteners\n   * @param m\n   */\n\n\n  function injectModel(createReducer, onError, unlisteners, m) {\n    m = model(m);\n    var store = app._store;\n    store.asyncReducers[m.namespace] = (0, _getReducer.default)(m.reducers, m.state, plugin._handleActions);\n    store.replaceReducer(createReducer());\n\n    if (m.effects) {\n      store.runSaga(app._getSaga(m.effects, m, onError, plugin.get('onEffect')));\n    }\n\n    if (m.subscriptions) {\n      unlisteners[m.namespace] = (0, _subscription.run)(m.subscriptions, m, app, onError);\n    }\n  }\n  /**\n   * Unregister model.\n   *\n   * @param createReducer\n   * @param reducers\n   * @param unlisteners\n   * @param namespace\n   *\n   * Unexpected key warn problem:\n   * https://github.com/reactjs/redux/issues/1636\n   */\n\n\n  function unmodel(createReducer, reducers, unlisteners, namespace) {\n    var store = app._store; // Delete reducers\n\n    delete store.asyncReducers[namespace];\n    delete reducers[namespace];\n    store.replaceReducer(createReducer());\n    store.dispatch({\n      type: '@@dva/UPDATE'\n    }); // Cancel effects\n\n    store.dispatch({\n      type: \"\".concat(namespace, \"/@@CANCEL_EFFECTS\")\n    }); // Unlisten subscrioptions\n\n    (0, _subscription.unlisten)(unlisteners, namespace); // Delete model from app._models\n\n    app._models = app._models.filter(function (model) {\n      return model.namespace !== namespace;\n    });\n  }\n  /**\n   * Replace a model if it exsits, if not, add it to app\n   * Attention:\n   * - Only available after dva.start gets called\n   * - Will not check origin m is strict equal to the new one\n   * Useful for HMR\n   * @param createReducer\n   * @param reducers\n   * @param unlisteners\n   * @param onError\n   * @param m\n   */\n\n\n  function replaceModel(createReducer, reducers, unlisteners, onError, m) {\n    var store = app._store;\n    var namespace = m.namespace;\n    var oldModelIdx = (0, _utils.findIndex)(app._models, function (model) {\n      return model.namespace === namespace;\n    });\n\n    if (~oldModelIdx) {\n      // Cancel effects\n      store.dispatch({\n        type: \"\".concat(namespace, \"/@@CANCEL_EFFECTS\")\n      }); // Delete reducers\n\n      delete store.asyncReducers[namespace];\n      delete reducers[namespace]; // Unlisten subscrioptions\n\n      (0, _subscription.unlisten)(unlisteners, namespace); // Delete model from app._models\n\n      app._models.splice(oldModelIdx, 1);\n    } // add new version model to store\n\n\n    app.model(m);\n    store.dispatch({\n      type: '@@dva/UPDATE'\n    });\n  }\n  /**\n   * Start the app.\n   *\n   * @returns void\n   */\n\n\n  function start() {\n    // Global error handler\n    var onError = function onError(err, extension) {\n      if (err) {\n        if (typeof err === 'string') err = new Error(err);\n\n        err.preventDefault = function () {\n          err._dontReject = true;\n        };\n\n        plugin.apply('onError', function (err) {\n          throw new Error(err.stack || err);\n        })(err, app._store.dispatch, extension);\n      }\n    };\n\n    var sagaMiddleware = (0, _middleware.default)();\n    var promiseMiddleware = (0, _createPromiseMiddleware.default)(app);\n    app._getSaga = _getSaga.default.bind(null);\n    var sagas = [];\n    var reducers = (0, _objectSpread2.default)({}, initialReducer);\n    var _iteratorNormalCompletion = true;\n    var _didIteratorError = false;\n    var _iteratorError = undefined;\n\n    try {\n      for (var _iterator = (0, _getIterator2.default)(app._models), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n        var m = _step.value;\n        reducers[m.namespace] = (0, _getReducer.default)(m.reducers, m.state, plugin._handleActions);\n        if (m.effects) sagas.push(app._getSaga(m.effects, m, onError, plugin.get('onEffect')));\n      }\n    } catch (err) {\n      _didIteratorError = true;\n      _iteratorError = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion && _iterator.return != null) {\n          _iterator.return();\n        }\n      } finally {\n        if (_didIteratorError) {\n          throw _iteratorError;\n        }\n      }\n    }\n\n    var reducerEnhancer = plugin.get('onReducer');\n    var extraReducers = plugin.get('extraReducers');\n    (0, _invariant.default)((0, _keys.default)(extraReducers).every(function (key) {\n      return !(key in reducers);\n    }), \"[app.start] extraReducers is conflict with other reducers, reducers list: \".concat((0, _keys.default)(reducers).join(', '))); // Create store\n\n    var store = app._store = (0, _createStore.default)({\n      // eslint-disable-line\n      reducers: createReducer(),\n      initialState: hooksAndOpts.initialState || {},\n      plugin: plugin,\n      createOpts: createOpts,\n      sagaMiddleware: sagaMiddleware,\n      promiseMiddleware: promiseMiddleware\n    }); // Extend store\n\n    store.runSaga = sagaMiddleware.run;\n    store.asyncReducers = {}; // Execute listeners when state is changed\n\n    var listeners = plugin.get('onStateChange');\n    var _iteratorNormalCompletion2 = true;\n    var _didIteratorError2 = false;\n    var _iteratorError2 = undefined;\n\n    try {\n      var _loop = function _loop() {\n        var listener = _step2.value;\n        store.subscribe(function () {\n          listener(store.getState());\n        });\n      };\n\n      for (var _iterator2 = (0, _getIterator2.default)(listeners), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n        _loop();\n      } // Run sagas\n\n    } catch (err) {\n      _didIteratorError2 = true;\n      _iteratorError2 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n          _iterator2.return();\n        }\n      } finally {\n        if (_didIteratorError2) {\n          throw _iteratorError2;\n        }\n      }\n    }\n\n    sagas.forEach(sagaMiddleware.run); // Setup app\n\n    setupApp(app); // Run subscriptions\n\n    var unlisteners = {};\n    var _iteratorNormalCompletion3 = true;\n    var _didIteratorError3 = false;\n    var _iteratorError3 = undefined;\n\n    try {\n      for (var _iterator3 = (0, _getIterator2.default)(this._models), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n        var _model = _step3.value;\n\n        if (_model.subscriptions) {\n          unlisteners[_model.namespace] = (0, _subscription.run)(_model.subscriptions, _model, app, onError);\n        }\n      } // Setup app.model and app.unmodel\n\n    } catch (err) {\n      _didIteratorError3 = true;\n      _iteratorError3 = err;\n    } finally {\n      try {\n        if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n          _iterator3.return();\n        }\n      } finally {\n        if (_didIteratorError3) {\n          throw _iteratorError3;\n        }\n      }\n    }\n\n    app.model = injectModel.bind(app, createReducer, onError, unlisteners);\n    app.unmodel = unmodel.bind(app, createReducer, reducers, unlisteners);\n    app.replaceModel = replaceModel.bind(app, createReducer, reducers, unlisteners, onError);\n    /**\n     * Create global reducer for redux.\n     *\n     * @returns {Object}\n     */\n\n    function createReducer() {\n      return reducerEnhancer((0, _redux.combineReducers)((0, _objectSpread2.default)({}, reducers, extraReducers, app._store ? app._store.asyncReducers : {})));\n    }\n  }\n}"]},"metadata":{},"sourceType":"script"}